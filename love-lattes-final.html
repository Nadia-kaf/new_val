<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Love&Lattes</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Montserrat:wght@300;400;500&display=swap"
      rel="stylesheet" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --rose-deep: #f5061a;
        --rose-medium: #d46577;
        --rose-light: #f4dde0;
        --cream: #fff8f3;
        --coffee: #4a3933;
        --gold: #d4af37;
        --white: #ffffff;
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background: #fff5f7;
        text-align: center;
        margin: 0;
      }

      .navbar {
        position: sticky;
        top: 0;
        z-index: 1000;
        width: 100%;
        background: linear-gradient(135deg, #a41528, #f87897);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        color: white;
        margin-bottom: 20px;
      }

      .logo {
        font-family: "Cormorant Garamond", serif;
        font-size: 2rem;
        font-weight: 700;
        color: var(--cream);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .logo-heart {
        color: var(--cream);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }

      .nav-buttons {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      /* Admin Profile Icon */
      .admin-profile-icon {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid white;
      }

      .admin-profile-icon:hover {
        transform: scale(1.1);
        background: rgba(255, 255, 255, 0.5);
      }

      .admin-profile-icon svg {
        width: 24px;
        height: 24px;
        fill: white;
      }

      /* Admin Navbar - Horizontal */
      .admin-nav {
        display: flex;
        gap: 1.5rem;
        align-items: center;
      }

      .admin-nav a {
        color: white;
        text-decoration: none;
        font-weight: 600;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
      }

      .admin-nav a:hover {
        color: var(--cream);
        transform: scale(1.05);
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 50px;
        font-family: "Montserrat", sans-serif;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--rose-deep),
          var(--rose-medium)
        );
        color: var(--white);
        box-shadow: 0 4px 15px rgba(139, 46, 63, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(139, 46, 63, 0.4);
      }

      .btn-secondary {
        background: transparent;
        color: white;
        border: 2px solid white;
      }

      .btn-secondary:hover {
        background: white;
        color: var(--rose-deep);
      }

      .btn-ghost {
        background: transparent;
        color: var(--coffee);
        padding: 0.5rem 1rem;
      }

      .btn-ghost:hover {
        color: var(--rose-deep);
      }

      /* Main Container */
      .container {
        max-width: 420px; /* mobile width */
        margin: 0 auto;
        background: #fff5f7;
        min-height: 100vh;
        padding: 0 15px;
      }

      .love-scene {
        position: relative;
        width: 100%;
        aspect-ratio: 16 / 9; /* responsive height */
        overflow: hidden;
        margin-bottom: 20px;
      }

      /* Hearts */
      .heart {
        position: absolute;
        font-size: clamp(14px, 4vw, 20px);
        color: #f5061a;
        opacity: 0;
        animation: floatHeart 6s infinite ease-in-out;
      }

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: relative;
        display: block;
      }

      /* Individual heart positions + delays */
      .h1 {
        left: -30px;
        bottom: 40px;
        animation-delay: 0s;
      }
      .h2 {
        left: -10px;
        bottom: 10px;
        animation-delay: 1s;
      }
      .h3 {
        right: -10px;
        bottom: 20px;
        animation-delay: 2s;
      }
      .h4 {
        right: -30px;
        bottom: 50px;
        animation-delay: 3s;
      }
      .h5 {
        left: 50%;
        bottom: -10px;
        animation-delay: 4s;
      }
      .h6 {
        left: 40%;
        bottom: -10px;
        animation-delay: 4s;
      }
      .h7 {
        left: 60%;
        bottom: -10px;
        animation-delay: 2s;
      }
      .h8 {
        left: 30%;
        bottom: -10px;
        animation-delay: 1s;
      }
      .h9 {
        left: 80%;
        bottom: -10px;
        animation-delay: 3s;
      }

      /* Curved floating motion */
      @keyframes floatHeart {
        0% {
          transform: translate(0, 0) scale(0.6);
          opacity: 0;
        }
        30% {
          opacity: 1;
        }
        50% {
          transform: translate(-30px, -80px) scale(1);
        }
        100% {
          transform: translate(-60px, -160px) scale(1.2);
          opacity: 0;
        }
      }

      /* Two Column Layout */
      .hero-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        align-items: start;
        margin: 2rem 0;
      }

      .hero-left {
        text-align: left;
      }

      .hero-left img {
        width: 100%;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(245, 6, 26, 0.2);
      }

      .hero-right {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      /* Landing Page */
      .landing {
        animation: fadeIn 1s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .hero {
        margin-top: 2rem;
        margin-bottom: 2rem;
      }

      .hero h1 {
        font-family: "Cormorant Garamond", serif;
        font-size: 3rem;
        font-weight: 700;
        color: var(--rose-deep);
        margin-bottom: 1rem;
        line-height: 1.2;
      }

      .hero p {
        font-size: 1.1rem;
        color: var(--coffee);
        opacity: 0.8;
        max-width: 100%;
        margin: 0 auto 1rem;
        line-height: 1.6;
      }

      .action-cards {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem 1.5rem;
        box-shadow: 0 10px 40px rgba(139, 46, 63, 0.15);
        transition: all 0.4s ease;
        cursor: pointer;
        border: 2px solid transparent;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 50px rgba(139, 46, 63, 0.25);
        border-color: var(--rose-light);
      }

      .card-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      .card h2 {
        font-family: "Cormorant Garamond", serif;
        font-size: 1.8rem;
        color: var(--rose-deep);
        margin-bottom: 0.75rem;
      }

      .card p {
        color: var(--coffee);
        opacity: 0.8;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        font-size: 0.95rem;
      }

      /* Question/Message Wall */
      .wall-container {
        animation: fadeIn 0.8s ease-out;
      }

      .wall-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .wall-header h1 {
        font-family: "Cormorant Garamond", serif;
        font-size: 2.5rem;
        color: var(--rose-deep);
        margin-bottom: 0.5rem;
      }

      .wall-header p {
        font-size: 1rem;
        color: var(--coffee);
        opacity: 0.7;
      }

      .input-section {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 40px rgba(139, 46, 63, 0.1);
      }

      .input-group {
        margin-bottom: 1.5rem;
        text-align: left;
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .input-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--coffee);
        font-weight: 500;
      }

      .input-group input,
      .input-group textarea,
      .input-group select {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid var(--rose-light);
        border-radius: 10px;
        font-family: "Montserrat", sans-serif;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: var(--white);
      }

      .input-group input:focus,
      .input-group textarea:focus,
      .input-group select:focus {
        outline: none;
        border-color: var(--rose-medium);
        box-shadow: 0 0 0 3px rgba(196, 109, 123, 0.1);
      }

      .input-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }

      .items-grid {
        display: grid;
        gap: 1.5rem;
      }

      .item-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 20px rgba(139, 46, 63, 0.1);
        transition: all 0.3s ease;
        animation: slideUp 0.5s ease-out;
        text-align: left;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .item-card:hover {
        box-shadow: 0 8px 30px rgba(139, 46, 63, 0.15);
      }

      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--rose-light);
      }

      .item-meta {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        font-size: 0.85rem;
        color: var(--coffee);
        opacity: 0.6;
        flex-wrap: wrap;
      }

      .item-badge {
        background: var(--rose-light);
        color: var(--rose-deep);
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .item-to {
        color: var(--rose-deep);
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
      }

      .item-content {
        color: var(--coffee);
        line-height: 1.7;
        font-size: 1rem;
      }

      .delete-btn {
        background: transparent;
        border: none;
        color: var(--rose-deep);
        cursor: pointer;
        padding: 0.5rem;
        opacity: 0.6;
        transition: all 0.3s ease;
        font-size: 1.2rem;
      }

      .delete-btn:hover {
        opacity: 1;
        transform: scale(1.1);
      }

      /* Login Form */
      .login-container {
        max-width: 400px;
        margin: 3rem auto;
        animation: fadeIn 0.8s ease-out;
      }

      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 15px 50px rgba(139, 46, 63, 0.2);
      }

      .login-card h2 {
        font-family: "Cormorant Garamond", serif;
        font-size: 2.5rem;
        color: var(--rose-deep);
        margin-bottom: 2rem;
        text-align: center;
      }

      .error-message {
        background: #fee;
        border: 1px solid #fcc;
        color: #c33;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        text-align: center;
        display: none;
      }

      /* Utility Classes */
      .hidden {
        display: none !important;
      }

      .text-center {
        text-align: center;
      }

      .mt-2 {
        margin-top: 2rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          max-width: 100%;
          padding: 0 15px;
        }

        .hero h1 {
          font-size: 2.5rem;
        }

        .hero p {
          font-size: 1rem;
        }

        .hero-content {
          grid-template-columns: 1fr;
        }

        .input-row {
          grid-template-columns: 1fr;
        }

        .button-group {
          flex-direction: column;
        }

        .admin-nav {
          gap: 1rem;
        }
      }

      /* Loading Animation */
      .loading {
        text-align: center;
        padding: 2rem;
        color: var(--rose-deep);
        font-size: 1.2rem;
      }

      .loading::after {
        content: "...";
        animation: dots 1.5s infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: ".";
        }
        40% {
          content: "..";
        }
        60%,
        100% {
          content: "...";
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
      <a href="#" class="logo" onclick="showLanding(event)">
        <span class="logo-heart">‚ô•</span>
        <span>Love&Lattes</span>
      </a>
      <div class="nav-buttons" id="navButtons">
        <!-- User view: Profile icon -->
        <div
          class="admin-profile-icon"
          onclick="showAdminLogin(event)"
          title="Admin Login">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
          </svg>
        </div>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
      <!-- Landing Page -->
      <div id="landingPage" class="landing">
        <div class="love-scene">
          <div class="love-box">
            <img
              src="./vals.jpeg"
              alt="Valentine"
              onerror="
                this.src =
                  'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22800%22 height=%22450%22%3E%3Crect fill=%22%23FFE5E5%22 width=%22800%22 height=%22450%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%22100%22%3Eüíï%3C/text%3E%3C/svg%3E'
              " />
          </div>
          <!-- Hearts trail -->
          <span class="heart h1">‚ù§</span>
          <span class="heart h2">‚ù§</span>
          <span class="heart h3">‚ù§</span>
          <span class="heart h4">‚ù§</span>
          <span class="heart h5">‚ù§</span>
          <span class="heart h6">‚ù§</span>
          <span class="heart h7">‚ù§</span>
          <span class="heart h8">‚ù§</span>
          <span class="heart h9">‚ù§</span>
        </div>

        <div class="hero">
          <p>
            Share your love message to special person(s) or ask questions
            anonymously üíñ
          </p>
        </div>

        <div class="action-cards">
          <div class="card" onclick="showQuestions()">
            <div class="card-icon">‚ùì</div>
            <h2>Ask Questions</h2>
            <p>
              Have something you'd like to know? Ask anonymously and receive
              heartfelt answers.
            </p>
            <button class="btn btn-primary">Get Started</button>
          </div>

          <div class="card" onclick="showMessages()">
            <div class="card-icon">üíå</div>
            <h2>Love Messages</h2>
            <p>
              Share a message of love to your loved one/crush or special people.
            </p>
            <button class="btn btn-primary">Share Love</button>
          </div>
        </div>
      </div>

      <!-- Questions Wall -->
      <div id="questionsWall" class="wall-container hidden">
        <div class="wall-header">
          <h1>Question Wall</h1>
          <p>What's on your mind?</p>
        </div>

        <div class="input-section">
          <div class="input-group">
            <label>Your Question (Anonymous) *</label>
            <textarea
              id="questionInput"
              placeholder="Type your question here..."
              required></textarea>
          </div>
          <div class="input-row">
            <div class="input-group">
              <label>Age Range *</label>
              <select id="questionAge" required>
                <option value="">Select age range</option>
                <option value="13-17">13-17</option>
                <option value="18-25">18-25</option>
                <option value="26-35">26-35</option>
                <option value="36-45">36-45</option>
                <option value="46-55">46-55</option>
                <option value="56+">56+</option>
              </select>
            </div>
            <div class="input-group">
              <label>Gender *</label>
              <select id="questionGender" required>
                <option value="">Select gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
          </div>
          <div class="button-group">
            <button class="btn btn-primary" onclick="submitQuestion()">
              Post Question
            </button>
            <button class="btn btn-secondary" onclick="showLanding(event)">
              Back
            </button>
          </div>
        </div>
      </div>

      <!-- Messages Wall -->
      <div id="messagesWall" class="wall-container hidden">
        <div class="wall-header">
          <h1>Love Message Wall</h1>
          <p>Spread the love ‚ù§Ô∏è</p>
        </div>

        <div class="input-section">
          <div class="input-group">
            <label>To: Name of the Person</label>
            <input
              type="text"
              id="messageRecipient"
              placeholder="Enter name (optional)" />
          </div>
          <div class="input-group">
            <label>Your Message (Anonymous)</label>
            <textarea
              id="messageInput"
              placeholder="Share your message of love..."></textarea>
          </div>
          <div class="button-group">
            <button class="btn btn-primary" onclick="submitMessage()">
              Post Message
            </button>
            <button class="btn btn-secondary" onclick="showLanding(event)">
              Back
            </button>
          </div>
        </div>
      </div>

      <!-- Admin Login -->
      <div id="adminLogin" class="login-container hidden">
        <div class="login-card">
          <h2>Admin Login</h2>
          <div id="loginError" class="error-message"></div>
          <div class="input-group">
            <label>Username</label>
            <input
              type="text"
              id="adminUsername"
              placeholder="Enter username" />
          </div>
          <div class="input-group">
            <label>Password</label>
            <input
              type="password"
              id="adminPassword"
              placeholder="Enter password" />
          </div>
          <button
            class="btn btn-primary"
            style="width: 100%"
            onclick="adminLogin()">
            Login
          </button>
          <div class="text-center mt-2">
            <a href="#" class="btn-ghost" onclick="showLanding(event)"
              >Back to Home</a
            >
          </div>
        </div>
      </div>

      <!-- Admin Questions -->
      <div id="adminQuestions" class="wall-container hidden">
        <div class="wall-header">
          <h1>Admin - Questions</h1>
          <p>Manage all questions</p>
        </div>

        <div id="adminQuestionsList" class="items-grid">
          <div class="loading">Loading questions</div>
        </div>
      </div>

      <!-- Admin Messages -->
      <div id="adminMessages" class="wall-container hidden">
        <div class="wall-header">
          <h1>Admin - Love Messages</h1>
          <p>Manage all messages</p>
        </div>

        <div id="adminMessagesList" class="items-grid">
          <div class="loading">Loading messages</div>
        </div>
      </div>
    </div>

    <script>
      // ===========================================
      // DATABASE CLASS
      // ===========================================

      class Database {
        constructor() {
          this.apiUrl = "https://new-val-api.onrender.com/api"; // Change to your API URL
        }

        async getQuestions() {
          const response = await fetch(`${this.apiUrl}/questions`);
          return await response.json();
        }

        async addQuestion(content, age, gender) {
          const response = await fetch(`${this.apiUrl}/questions`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content, age, gender }),
          });
          return await response.json();
        }

        async deleteQuestion(id) {
          const response = await fetch(`${this.apiUrl}/questions/${id}`, {
            method: "DELETE",
          });
          return await response.json();
        }

        async getMessages() {
          const response = await fetch(`${this.apiUrl}/messages`);
          return await response.json();
        }

        async addMessage(content, recipient) {
          const response = await fetch(`${this.apiUrl}/messages`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content, recipient }),
          });
          return await response.json();
        }

        async deleteMessage(id) {
          const response = await fetch(`${this.apiUrl}/messages/${id}`, {
            method: "DELETE",
          });
          return await response.json();
        }

        async verifyAdmin(username, password) {
          const response = await fetch(`${this.apiUrl}/admin/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });
          const data = await response.json();
          return data.success;
        }
      }

      const db = new Database();
      let isAdmin = false;

      // ===========================================
      // UI FUNCTIONS
      // ===========================================

      function hideAll() {
        document.getElementById("landingPage").classList.add("hidden");
        document.getElementById("questionsWall").classList.add("hidden");
        document.getElementById("messagesWall").classList.add("hidden");
        document.getElementById("adminLogin").classList.add("hidden");
        document.getElementById("adminQuestions").classList.add("hidden");
        document.getElementById("adminMessages").classList.add("hidden");
      }

      function updateNavbar() {
        const navButtons = document.getElementById("navButtons");

        if (isAdmin) {
          navButtons.innerHTML = `
            <div class="admin-nav">
              <a href="#" onclick="showAdminQuestions(event)">Questions</a>
              <a href="#" onclick="showAdminMessages(event)">Messages</a>
              <button class="btn btn-secondary" onclick="logout()">Sign Out</button>
            </div>
          `;
        } else {
          navButtons.innerHTML = `
            <div class="admin-profile-icon" onclick="showAdminLogin(event)" title="Admin Login">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </div>
          `;
        }
      }

      function showLanding(event) {
        if (event) event.preventDefault();
        hideAll();
        document.getElementById("landingPage").classList.remove("hidden");
        window.scrollTo(0, 0);
      }

      async function showQuestions() {
        hideAll();
        document.getElementById("questionsWall").classList.remove("hidden");
        // User view - no display of questions
        window.scrollTo(0, 0);
      }

      async function showMessages() {
        hideAll();
        document.getElementById("messagesWall").classList.remove("hidden");
        // User view - no display of messages
        window.scrollTo(0, 0);
      }

      function showAdminLogin(event) {
        if (event) event.preventDefault();
        if (isAdmin) {
          showAdminQuestions(event);
          return;
        }
        hideAll();
        document.getElementById("adminLogin").classList.remove("hidden");
        document.getElementById("loginError").style.display = "none";
        window.scrollTo(0, 0);
      }

      async function showAdminQuestions(event) {
        if (event) event.preventDefault();
        if (!isAdmin) {
          showAdminLogin(event);
          return;
        }
        hideAll();
        document.getElementById("adminQuestions").classList.remove("hidden");
        await loadAdminQuestions();
        window.scrollTo(0, 0);
      }

      async function showAdminMessages(event) {
        if (event) event.preventDefault();
        if (!isAdmin) {
          showAdminLogin(event);
          return;
        }
        hideAll();
        document.getElementById("adminMessages").classList.remove("hidden");
        await loadAdminMessages();
        window.scrollTo(0, 0);
      }

      // ===========================================
      // QUESTIONS FUNCTIONS
      // ===========================================

      async function submitQuestion() {
        const input = document.getElementById("questionInput");
        const age = document.getElementById("questionAge");
        const gender = document.getElementById("questionGender");
        const content = input.value.trim();
        const ageValue = age.value;
        const genderValue = gender.value;

        if (!content) {
          alert("Please enter a question!");
          return;
        }

        if (!ageValue) {
          alert("Please select your age range!");
          return;
        }

        if (!genderValue) {
          alert("Please select your gender!");
          return;
        }

        try {
          await db.addQuestion(content, ageValue, genderValue);
          input.value = "";
          age.value = "";
          gender.value = "";
          alert("Question posted successfully! üéâ");
        } catch (error) {
          console.error("Error posting question:", error);
          alert("Failed to post question. Please try again.");
        }
      }

      // ===========================================
      // MESSAGES FUNCTIONS
      // ===========================================

      async function submitMessage() {
        const input = document.getElementById("messageInput");
        const recipient = document.getElementById("messageRecipient");
        const content = input.value.trim();
        const recipientValue = recipient.value.trim();

        if (!content) {
          alert("Please enter a message!");
          return;
        }

        try {
          await db.addMessage(content, recipientValue);
          input.value = "";
          recipient.value = "";
          alert("Message posted successfully! üíï");
        } catch (error) {
          console.error("Error posting message:", error);
          alert("Failed to post message. Please try again.");
        }
      }

      // ===========================================
      // ADMIN FUNCTIONS
      // ===========================================

      async function adminLogin() {
        const username = document.getElementById("adminUsername").value.trim();
        const password = document.getElementById("adminPassword").value;
        const errorDiv = document.getElementById("loginError");

        if (!username || !password) {
          errorDiv.textContent = "Please enter both username and password";
          errorDiv.style.display = "block";
          return;
        }

        try {
          const valid = await db.verifyAdmin(username, password);

          if (valid) {
            isAdmin = true;
            updateNavbar();
            showAdminQuestions();
          } else {
            errorDiv.textContent = "Invalid username or password";
            errorDiv.style.display = "block";
            document.getElementById("adminPassword").value = "";
          }
        } catch (error) {
          console.error("Login error:", error);
          errorDiv.textContent = "Login failed. Please try again.";
          errorDiv.style.display = "block";
        }
      }

      function logout() {
        isAdmin = false;
        updateNavbar();
        showLanding();
      }

      async function loadAdminQuestions() {
        const container = document.getElementById("adminQuestionsList");
        container.innerHTML = '<div class="loading">Loading questions</div>';

        try {
          const questions = await db.getQuestions();

          if (questions.length === 0) {
            container.innerHTML = `
              <div class="text-center" style="padding: 3rem; opacity: 0.6;">
                <p style="font-size: 1.2rem;">No questions yet.</p>
              </div>
            `;
            return;
          }

          container.innerHTML = questions
            .map(
              (q) => `
              <div class="item-card">
                <div class="item-header">
                  <div class="item-meta">
                    <span class="item-badge">${q.age || "N/A"}</span>
                    <span class="item-badge">${q.gender || "N/A"}</span>
                    <span>üìÖ ${q.date}</span>
                    <span>üïí ${q.time}</span>
                  </div>
                  <button class="delete-btn" onclick="deleteQuestion('${q.id || q._id}')" title="Delete">üóëÔ∏è</button>
                </div>
                <div class="item-content">${escapeHtml(q.content)}</div>
              </div>
            `,
            )
            .join("");
        } catch (error) {
          console.error("Error loading questions:", error);
          container.innerHTML = `
            <div class="text-center" style="padding: 3rem; opacity: 0.6;">
              <p style="font-size: 1.2rem; color: red;">Failed to load questions.</p>
            </div>
          `;
        }
      }

      async function loadAdminMessages() {
        const container = document.getElementById("adminMessagesList");
        container.innerHTML = '<div class="loading">Loading messages</div>';

        try {
          const messages = await db.getMessages();

          if (messages.length === 0) {
            container.innerHTML = `
              <div class="text-center" style="padding: 3rem; opacity: 0.6;">
                <p style="font-size: 1.2rem;">No messages yet.</p>
              </div>
            `;
            return;
          }

          container.innerHTML = messages
            .map(
              (m) => `
              <div class="item-card">
                <div class="item-header">
                  <div class="item-meta">
                    <span>üìÖ ${m.date}</span>
                    <span>üïí ${m.time}</span>
                  </div>
                  <button class="delete-btn" onclick="deleteMessage('${m.id || m._id}')" title="Delete">üóëÔ∏è</button>
                </div>
                ${m.recipient ? `<div class="item-to">To: ${escapeHtml(m.recipient)}</div>` : ""}
                <div class="item-content">${escapeHtml(m.content)}</div>
              </div>
            `,
            )
            .join("");
        } catch (error) {
          console.error("Error loading messages:", error);
          container.innerHTML = `
            <div class="text-center" style="padding: 3rem; opacity: 0.6;">
              <p style="font-size: 1.2rem; color: red;">Failed to load messages.</p>
            </div>
          `;
        }
      }

      async function deleteQuestion(id) {
        if (!confirm("Are you sure you want to delete this question?")) return;
        try {
          await db.deleteQuestion(id);
          await loadAdminQuestions();
        } catch (error) {
          console.error("Error deleting question:", error);
          alert("Failed to delete question.");
        }
      }

      async function deleteMessage(id) {
        if (!confirm("Are you sure you want to delete this message?")) return;
        try {
          await db.deleteMessage(id);
          await loadAdminMessages();
        } catch (error) {
          console.error("Error deleting message:", error);
          alert("Failed to delete message.");
        }
      }

      // ===========================================
      // UTILITY FUNCTIONS
      // ===========================================

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // ===========================================
      // INITIALIZATION
      // ===========================================

      window.addEventListener("DOMContentLoaded", () => {
        updateNavbar();

        // Handle Enter key in login form
        document
          .getElementById("adminPassword")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") adminLogin();
          });
      });
    </script>
  </body>
</html>
